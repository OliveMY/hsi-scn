from yacs.config import CfgNode as CN
from yaml import Node

cfg = CN()

# Dataset related configuration
cfg.DATASET = CN()
cfg.DATASET.NAME = 'ARAD'   # ARAD / ICVL
cfg.DATASET.ROOT = '/mnt/data/ARAD/'       # root directory of the dataset
cfg.DATASET.PRELOAD = True  # if to preload the dataset into memory
cfg.DATASET.BATCH_SIZE = 8  # train batch size

# transforms configuration
cfg.DATASET.TRANSFORMS = CN()
cfg.DATASET.TRANSFORMS.RANDOM_CROP = 256        # crop size
cfg.DATASET.TRANSFORMS.FLIP_HORI_RATE = 0.5     # flip horizontal rate
cfg.DATASET.TRANSFORMS.FLIP_VERTI_RATE = 0.5    # flip vertical rate
cfg.DATASET.TRANSFORMS.TRANSPOSE_RATE = 0.5     # transpose rate
cfg.DATASET.TRANSFORMS.NORMAL_HS_MEAN = [0.0521131232380867, 0.06268781423568726, 0.06984599679708481, 0.07920802384614944, 0.09155125170946121, 0.10336703062057495, 0.11041561514139175, 0.11313623189926147, 0.11474372446537018, 0.11717329174280167, 0.12106425315141678, 0.1258954256772995, 0.13235120475292206, 0.14121705293655396, 0.15045686066150665, 0.15681621432304382, 0.1596515029668808, 0.1619700789451599, 0.16505402326583862, 0.16802524030208588, 0.17157375812530518, 0.17458570003509521, 0.17525169253349304, 0.1751810908317566, 0.17547035217285156, 0.17557261884212494, 0.17722319066524506, 0.17922620475292206, 0.17837490141391754, 0.18008632957935333, 0.19097746908664703]     # normalize HS mean
cfg.DATASET.TRANSFORMS.NORMAL_HS_STD = [0.07240621000528336, 0.08788689970970154, 0.09462165087461472, 0.1040840670466423, 0.11745947599411011, 0.13159601390361786, 0.13892321288585663, 0.13946674764156342, 0.1394687443971634, 0.14028388261795044, 0.1418474316596985, 0.14360861480236053, 0.14659710228443146, 0.15241174399852753, 0.16000530123710632, 0.16552451252937317, 0.16734758019447327, 0.16969196498394012, 0.17310984432697296, 0.17541243135929108, 0.17784762382507324, 0.18005889654159546, 0.18026772141456604, 0.18030904233455658, 0.181451678276062, 0.1829567402601242, 0.18625153601169586, 0.18931302428245544, 0.18676485121250153, 0.18260857462882996, 0.18492121994495392]    # normalize HS std
cfg.DATASET.TRANSFORMS.NORMAL_RGB_MEAN = [0.0, 0.0, 0.0]    # normalize rgb mean
cfg.DATASET.TRANSFORMS.NORMAL_RGB_STD = [1.0, 1.0, 1.0]     # normalize rgb std

# specified configuration for finetuning
cfg.DATASET.TESTSET = None
cfg.DATASET.RANDOMRATIO = 0.3
cfg.DATASET.FTTARGET = []


# model related configuration
cfg.MODEL = CN()
cfg.MODEL.TYPE = 'MSTPP'
cfg.MODEL.PRETRAIN = ""
cfg.MODEL.LOAD = ""
cfg.MODEL.LOAD_BB = ""

# train related configuration
cfg.TRAIN = CN()
cfg.TRAIN.LOG = 'log'           # log directory
cfg.TRAIN.LR = 1e-4             # learning rate
cfg.TRAIN.OPTIMIZER = 'adam'    # optimizer
cfg.TRAIN.SCHEDULER = 'cos'
cfg.TRAIN.ITERS = 100000        # total iterations
cfg.TRAIN.LOSS = ['L1', 1.0]  # losses and corresponding weights
cfg.TRAIN.WARMUP = False
cfg.TRAIN.SWA = CN()
cfg.TRAIN.SWA.START = -1
cfg.TRAIN.SWA.LR = 0.05

# validate settings
cfg.VALIDATE_PAD = [0, 0, 0, 0]
cfg.VALIDATE_PATCH = -1


def get_default_config():
    return cfg

def reset_some_value(cfg:CN):
    if len(cfg.DATASET.TRANSFORMS.NORMAL_HS_MEAN) == 0:
        cfg.DATASET.TRANSFORMS.NORMAL_HS_MEAN = [0.0] * 31
    if len(cfg.DATASET.TRANSFORMS.NORMAL_HS_STD) == 0:
        cfg.DATASET.TRANSFORMS.NORMAL_HS_STD = [1.0] * 31
    return cfg